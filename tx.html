<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>System Update</title>
<style>
  /* --- CẤU HÌNH CHUNG --- */
  body, html {
    margin: 0; padding: 0; width: 100%; height: 100%;
    overflow: hidden; user-select: none; cursor: none;
    background-color: #000;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }
  
  .hidden { display: none !important; }

  /* Màn hình bắt đầu (để kích hoạt Fullscreen & Sound) */
  #overlay-start {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #000; z-index: 9999;
    display: flex; justify-content: center; align-items: center;
    color: #fff; font-family: monospace;
    cursor: pointer; text-align: center;
  }
  .blink { animation: blinker 1s linear infinite; }
  @keyframes blinker { 50% { opacity: 0; } }

  /* --- GIAO DIỆN WINDOWS (BSOD) --- */
  #view-windows {
    background-color: #0078d7; color: #fff;
    padding: 10% 15%; height: 100%; box-sizing: border-box;
    display: none;
  }
  .win-sad { font-size: 100px; margin-bottom: 30px; }
  .win-title { font-size: 24px; margin-bottom: 20px; font-weight: 300; }
  .win-details { margin-top: 30px; display: flex; align-items: center; font-size: 14px; }
  .qr-code { width: 100px; height: 100px; background: #fff; margin-right: 15px; }

  /* --- GIAO DIỆN MACOS (Kernel Panic) --- */
  #view-mac {
    background-color: #1a1a1a; color: #d6d6d6;
    height: 100%; display: none;
    flex-direction: column; justify-content: center; align-items: center;
    text-align: center;
    position: relative;
  }
  #view-mac::before {
    content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.5); /* Hiệu ứng màn mờ */
  }
  .mac-box {
    z-index: 2; width: 300px;
    background: #2b2b2b; padding: 40px; border-radius: 10px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.8);
  }
  .power-icon {
    width: 60px; height: 60px; border: 3px solid #888; border-radius: 50%;
    margin: 0 auto 20px; position: relative;
  }
  .power-line {
    position: absolute; top: -10%; left: 50%; transform: translateX(-50%);
    width: 3px; height: 25px; background: #2b2b2b; z-index: 2;
  }
  .power-symbol {
    position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
    width: 3px; height: 20px; background: #888;
  }

  /* --- GIAO DIỆN MOBILE (Android/iOS Hacking) --- */
  #view-mobile {
    background-color: #000; color: #0f0;
    font-family: 'Courier New', Courier, monospace;
    height: 100%; display: none;
    flex-direction: column; padding: 20px;
  }
  .term-line { margin-bottom: 5px; font-size: 14px; word-break: break-all;}
  .mobile-alert-box {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background: #222; border: 1px solid #444; color: #fff;
    padding: 20px; width: 80%; border-radius: 8px;
    text-align: center; box-shadow: 0 0 20px rgba(255,0,0,0.5);
    display: none; font-family: sans-serif;
  }
  .progress-bar {
    width: 100%; height: 10px; background: #333; margin-top: 15px;
    border-radius: 5px; overflow: hidden;
  }
  .progress-fill {
    height: 100%; background: #f00; width: 0%; transition: width 0.2s;
  }
</style>
</head>
<body>

<div id="overlay-start">
  <div>
    <h1>SYSTEM DIAGNOSTIC TOOL</h1>
    <p class="blink">TAP ANYWHERE TO START</p>
  </div>
</div>

<div id="view-windows">
  <div class="win-sad">:(</div>
  <div class="win-title">Your PC ran into a problem and needs to restart. We're just collecting some error info, and then we'll restart for you.</div>
  <div class="win-title" id="win-percent">0% complete</div>
  <div class="win-details">
    <div class="qr-code" style="display:flex; justify-content:center; align-items:center; color:#0078d7; font-weight:bold;">QR</div>
    <div>
      <p>For more information about this issue and possible fixes, visit https://www.windows.com/stopcode</p>
      <p>If you call a support person, give them this info:</p>
      <p>Stop code: CRITICAL_PROCESS_DIED</p>
    </div>
  </div>
</div>

<div id="view-mac">
  <div class="mac-box">
    <div class="power-icon">
        <div class="power-line"></div>
        <div class="power-symbol"></div>
    </div>
    <p style="font-weight: bold; margin-bottom: 10px;">You need to restart your computer.</p>
    <p style="font-size: 12px; color: #888;">Hold down the Power button for several seconds or press the Restart button.</p>
    <br>
    <p style="font-size: 12px; color: #888;">Veuillez redémarrer votre ordinateur.</p>
    <p style="font-size: 12px; color: #888;">Sie müssen Ihren Computer neu starten.</p>
    <p style="font-size: 12px; color: #888;">電腦因出現問題而重新啟動。</p>
  </div>
</div>

<div id="view-mobile">
  <div id="term-output"></div>
  <div class="mobile-alert-box" id="mobile-popup">
    <h3 style="color:red; margin-top:0;">CRITICAL FAILURE</h3>
    <p>System files corrupted.</p>
    <p>Initiating Emergency Factory Reset...</p>
    <div class="progress-bar"><div class="progress-fill" id="reset-bar"></div></div>
    <p id="reset-text" style="font-size:12px; margin-top:5px; color:#aaa;">Erasing /data/user/0...</p>
  </div>
</div>

<script>
  // --- DETECT OS ---
  function getOS() {
    const userAgent = window.navigator.userAgent;
    const platform = window.navigator.platform;
    const macosPlatforms = ['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'];
    const windowsPlatforms = ['Win32', 'Win64', 'Windows', 'WinCE'];
    const iosPlatforms = ['iPhone', 'iPad', 'iPod'];

    if (macosPlatforms.indexOf(platform) !== -1) return 'Mac';
    if (iosPlatforms.indexOf(platform) !== -1) return 'iOS';
    if (windowsPlatforms.indexOf(platform) !== -1) return 'Windows';
    if (/Android/.test(userAgent)) return 'Android';
    if (/Linux/.test(platform)) return 'Linux'; // Coi như Android/Linux
    return 'Unknown';
  }

  // --- AUDIO ENGINE ---
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  function playSound(type) {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    
    if (type === 'beep') { // Windows error beep
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(400, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.5);
    } else if (type === 'glitch') { // Mobile glitch
        osc.type = 'square';
        osc.frequency.setValueAtTime(Math.random()*1000, audioCtx.currentTime);
    } else if (type === 'static') { // Noise
        // Noise buffer logic here (simplified)
        osc.type = 'triangle';
        osc.frequency.setValueAtTime(50, audioCtx.currentTime);
    }

    osc.connect(gain);
    gain.connect(audioCtx.destination);
    
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
    
    osc.start();
    osc.stop(audioCtx.currentTime + 0.5);
  }

  // --- LOGIC CHÍNH ---
  document.getElementById('overlay-start').addEventListener('click', function() {
    // 1. Fullscreen
    const elem = document.documentElement;
    if (elem.requestFullscreen) { elem.requestFullscreen(); } 
    else if (elem.webkitRequestFullscreen) { elem.webkitRequestFullscreen(); } // Safari

    // 2. Audio Init
    audioCtx.resume();

    // 3. Detect & Render
    this.style.display = 'none';
    const os = getOS();
    
    if (os === 'Windows') {
        startWindowsScenario();
    } else if (os === 'Mac') {
        startMacScenario();
    } else if (os === 'Android' || os === 'iOS' || os === 'Linux') {
        startMobileScenario();
    } else {
        // Mặc định cho unknown
        startMobileScenario(); 
    }
  });

  // --- KỊCH BẢN WINDOWS ---
  function startWindowsScenario() {
    const view = document.getElementById('view-windows');
    view.style.display = 'block';
    document.body.style.cursor = 'none';
    
    // Giả lập tiếng ổ cứng treo
    const loopSound = setInterval(() => playSound('beep'), 200); // Tiếng è è khó chịu
    setTimeout(() => clearInterval(loopSound), 2000); // Tắt sau 2s để tạo cảm giác "im lặng chết chóc"

    let percent = 0;
    const pText = document.getElementById('win-percent');
    
    // Tăng % chậm chạp gây ức chế
    const interval = setInterval(() => {
        const jump = Math.random() > 0.8 ? 5 : 0; // Thỉnh thoảng mới nhảy số
        percent += jump;
        if (percent >= 100) percent = 100;
        pText.innerText = percent + "% complete";
        
        if (percent === 100) {
            clearInterval(interval);
            // Có thể thêm hành động restart giả ở đây
        }
    }, 1000);
  }

  // --- KỊCH BẢN MAC ---
  function startMacScenario() {
    const view = document.getElementById('view-mac');
    view.style.display = 'flex';
    document.body.style.cursor = 'none';
    
    // Mac kernel panic thường im lặng và tối dần
    let opacity = 1;
    setInterval(() => {
       // Hiệu ứng mờ dần nhẹ
    }, 100);
  }

  // --- KỊCH BẢN MOBILE (Rung + Terminal + Fake Reset) ---
  function startMobileScenario() {
    const view = document.getElementById('view-mobile');
    view.style.display = 'flex';
    const term = document.getElementById('term-output');
    const popup = document.getElementById('mobile-popup');
    const bar = document.getElementById('reset-bar');
    const txt = document.getElementById('reset-text');

    // Chạy các dòng lệnh hacker
    let lines = [
        "Root access: GRANTED",
        "Bypassing Knox security...",
        "Injecting payload.bin...",
        "Overwriting bootloader...",
        "Mounting /system read-write...",
        "Deleting user partition..."
    ];
    
    let i = 0;
    const termInterval = setInterval(() => {
        if (i < lines.length) {
            term.innerHTML += `<div class="term-line">> ${lines[i]}</div>`;
            playSound('glitch');
            // RUNG ĐIỆN THOẠI (Rất quan trọng)
            if (navigator.vibrate) navigator.vibrate(50); 
            i++;
        } else {
            clearInterval(termInterval);
            // Hiện popup Factory Reset giả
            setTimeout(() => {
                popup.style.display = 'block';
                // Rung dài cảnh báo
                if (navigator.vibrate) navigator.vibrate([200, 100, 200, 100, 500]);
                startFakeReset();
            }, 500);
        }
    }, 300);

    function startFakeReset() {
        let width = 0;
        setInterval(() => {
            width += Math.random() * 2;
            if (width > 100) width = 100;
            bar.style.width = width + "%";
            
            if (Math.random() > 0.8) {
                txt.innerText = "Erasing block 0x" + Math.floor(Math.random()*999999);
                playSound('static');
            }
        }, 100);
    }
  }

  // Chặn phím thoát cơ bản
  document.addEventListener('keydown', (e) => {
      if (e.key === 'F11' || e.key === 'Escape') {
          e.preventDefault(); // Cố gắng chặn (trình duyệt có thể override)
      }
  });
</script>
</body>
</html>
